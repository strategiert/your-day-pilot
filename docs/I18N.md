# Internationalization (i18n) Documentation

This document describes the multi-language support implemented in Your Day Pilot.

## Supported Languages

- **English (en)** - Default
- **German (de)** - Deutsch
- **Spanish (es)** - EspaÃ±ol
- **French (fr)** - FranÃ§ais
- **Italian (it)** - Italiano

## Language Detection Priority

The application automatically detects the user's preferred language using the following priority:

1. **User Preference** - Language selected by the user in Settings
2. **Geo-location** - Detected from user's IP address using ipapi.co
3. **Browser Language** - Detected from browser settings
4. **Default** - Falls back to English (en)

## Architecture

### Directory Structure

```
src/i18n/
â”œâ”€â”€ index.ts                    # Main i18n configuration
â”œâ”€â”€ detectLanguage.ts           # Language detection logic
â””â”€â”€ locales/
    â”œâ”€â”€ en/                     # English translations
    â”‚   â”œâ”€â”€ common.json
    â”‚   â”œâ”€â”€ auth.json
    â”‚   â””â”€â”€ settings.json
    â”œâ”€â”€ de/                     # German translations
    â”œâ”€â”€ es/                     # Spanish translations
    â”œâ”€â”€ fr/                     # French translations
    â””â”€â”€ it/                     # Italian translations
```

### Key Files

#### `src/i18n/index.ts`

Main i18n configuration using i18next and react-i18next. Initializes the language detector and loads translation resources.

#### `src/i18n/detectLanguage.ts`

Contains the language detection logic:
- `detectLanguage()` - Main detection function (async)
- `saveLanguagePreference()` - Saves user's language choice
- `getLanguageName()` - Returns language display name
- `getLanguageFlag()` - Returns language flag emoji

#### Translation Files

Organized by namespace:
- `common.json` - Common UI strings (app name, buttons, etc.)
- `auth.json` - Authentication page strings
- `settings.json` - Settings page strings

## Usage

### In React Components

```tsx
import { useTranslation } from 'react-i18next';

function MyComponent() {
  const { t } = useTranslation('namespace');

  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('section.description')}</p>
    </div>
  );
}
```

### Language Toggle Component

The `LanguageToggle` component is integrated into the Settings page and allows users to manually select their preferred language.

```tsx
import { LanguageToggle } from '@/components/LanguageToggle';

<LanguageToggle />
```

## Translation Workflow

### Automatic Translation with DeepL

We provide a script to automatically translate English strings to all other languages using the DeepL API.

#### Prerequisites

1. Get a DeepL API key from https://www.deepl.com/pro-api
2. Set the API key as an environment variable

#### Running the Translation Script

```bash
# Set your DeepL API key
export DEEPL_API_KEY=your_key_here

# Run the translation script
npm run translate
```

The script will:
1. Read all JSON files from `src/i18n/locales/en/`
2. Translate them to German, Spanish, French, and Italian
3. Write the translated files to their respective locale directories

#### Manual Translation

For sensitive or context-specific content, you can manually edit the JSON files in each locale directory.

## Geo-location Service

We use **ipapi.co** for IP-based geo-location:
- **Free Tier**: 30,000 requests per month
- **No API Key Required**
- **No Account Needed**

The service maps the user's country code to the appropriate language:

```typescript
const COUNTRY_TO_LANGUAGE = {
  DE: 'de', AT: 'de', CH: 'de',  // German-speaking
  ES: 'es', MX: 'es', AR: 'es',  // Spanish-speaking
  FR: 'fr', BE: 'fr', CA: 'fr',  // French-speaking
  IT: 'it', SM: 'it', VA: 'it',  // Italian-speaking
  // ... 40+ countries supported
};
```

## Adding a New Language

To add a new language (e.g., Portuguese):

1. **Update Type Definition**
   ```typescript
   // src/i18n/detectLanguage.ts
   export type SupportedLanguage = 'en' | 'de' | 'es' | 'fr' | 'it' | 'pt';
   ```

2. **Add Country Mapping**
   ```typescript
   const COUNTRY_TO_LANGUAGE = {
     // ... existing mappings
     PT: 'pt', BR: 'pt',  // Portuguese-speaking
   };
   ```

3. **Add Display Metadata**
   ```typescript
   const LANGUAGE_NAMES = {
     // ... existing languages
     pt: 'PortuguÃªs',
   };

   const LANGUAGE_FLAGS = {
     // ... existing flags
     pt: 'ðŸ‡µðŸ‡¹',
   };
   ```

4. **Create Translation Directory**
   ```bash
   mkdir -p src/i18n/locales/pt
   ```

5. **Add to i18n Config**
   ```typescript
   // src/i18n/index.ts
   const resources = {
     // ... existing languages
     pt: {
       common: {},
       auth: {},
       settings: {},
     },
   };
   ```

6. **Update Translation Script**
   ```typescript
   // scripts/translate.ts
   const TARGET_LANGUAGES = {
     // ... existing languages
     pt: 'PT',  // DeepL language code
   };
   ```

## Best Practices

### 1. Namespace Organization

Group related translations into namespaces:
- `common` - App-wide strings (buttons, navigation, etc.)
- `auth` - Authentication flows
- `settings` - Settings page
- `dashboard` - Dashboard-specific strings

### 2. Translation Keys

Use descriptive, hierarchical keys:

```json
{
  "section": {
    "title": "Section Title",
    "description": "Section description"
  }
}
```

### 3. Interpolation

For dynamic content, use interpolation:

```json
{
  "welcome": "Welcome, {{name}}!"
}
```

```tsx
t('welcome', { name: user.name })
```

### 4. Pluralization

Use i18next's pluralization features:

```json
{
  "item_one": "{{count}} item",
  "item_other": "{{count}} items"
}
```

```tsx
t('item', { count: items.length })
```

## Testing

### Manual Testing

1. Go to Settings page
2. Select different languages from the Language dropdown
3. Navigate through the app to verify translations
4. Check that the language preference persists after refresh

### Automated Testing

```bash
# Build with language files
npm run build

# Check for missing translations
npm run translate -- --check
```

## Troubleshooting

### Language Not Detected

1. Check browser console for i18n errors
2. Verify ipapi.co is accessible (check network tab)
3. Ensure localStorage is not disabled

### Missing Translations

If you see translation keys instead of text:
1. Check that the JSON file exists for that language
2. Verify the key path is correct
3. Ensure the namespace is loaded in `src/i18n/index.ts`

### DeepL API Errors

Common issues:
- **401 Unauthorized**: Check your API key
- **403 Forbidden**: API key may be invalid or expired
- **429 Too Many Requests**: Rate limit exceeded, wait and retry
- **456 Quota Exceeded**: Monthly character limit reached

## Environment Variables

Required for translation script:

```bash
# .env
DEEPL_API_KEY=your_deepl_api_key_here
```

## Resources

- [i18next Documentation](https://www.i18next.com/)
- [react-i18next Documentation](https://react.i18next.com/)
- [DeepL API Documentation](https://www.deepl.com/docs-api)
- [ipapi.co Documentation](https://ipapi.co/api/)

---

*Last Updated: 2025-12-26*
